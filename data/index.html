<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contro - Supervision</title>
    <link rel="stylesheet" href="css/app.css?v=5" />
    <link rel="icon" href="icons/power-16.png" type="image/png" />
  </head>
  <body>
    <div class="ui-container">
      <aside class="sidebar">
        <div class="tab active" data-tab="live">Temps reel</div>
        <div class="tab" data-tab="charts">Graphiques</div>
        <div class="tab" data-tab="events">Alertes</div>
        <div class="tab" data-tab="config">Configuration</div>
        <div class="tab" data-tab="service">Service</div>

        <div class="sidebar-spacer"></div>

        <div class="sidebar-footer">
          <button id="btnStart" class="side-btn side-btn-run" type="button">
            <img src="icons/power.png" alt="" />
            Marche
          </button>
          <button id="btnStop" class="side-btn side-btn-stop" type="button">
            <img src="icons/redo-5-16.png" alt="" />
            Arret
          </button>
          <button id="muteBtn" class="side-btn side-btn-mute" type="button">
            <img id="muteIcon" src="icons/volume-up-4-256.png" alt="" />
            <span id="muteLabel">Son</span>
          </button>
        </div>
      </aside>

      <main class="main">
        <header class="statusbar">
          <div class="sb-left">
            <div class="sb-brand">Contro</div>
            <div class="tiny" id="deviceMeta">
              IP: -- | mDNS: -- | Version: --
            </div>
          </div>

          <div class="sb-metrics">
            <div class="sb-metric">
              <div class="sb-label">Courant</div>
              <div class="sb-value" id="sbCurrent">-- A</div>
            </div>
            <div class="sb-metric">
              <div class="sb-label">T moteur</div>
              <div class="sb-value" id="sbMotorTemp">-- C</div>
            </div>
            <div class="sb-metric">
              <div class="sb-label">T carte</div>
              <div class="sb-value" id="sbBoardTemp">-- C</div>
            </div>
          </div>

          <div class="sb-right">
            <div class="sb-row">
              <div class="status-dot" id="stateDot" title="Etat"></div>
              <div class="status-chip" id="stateChip">Etat: --</div>
              <div class="status-chip" id="relayChip">Relais: --</div>
              <div class="status-chip" id="faultChip">Defaut: --</div>
              <div class="status-chip warn" id="warningChip">W--</div>
              <div class="status-chip err" id="errorChip">E--</div>
            </div>
            <div class="sb-actions">
              <button class="btn sb-btn" id="loginBtn">Connexion</button>
              <button class="btn sb-btn" id="logoutBtn">Deconnexion</button>
            </div>
          </div>
        </header>

        <div class="pages">
          <section id="liveTab" class="content active">
            <div class="gauges">
              <div
                class="gauge-card"
                data-field="current_a"
                data-unit="A"
                data-max="20"
              >
                <div class="gauge">
                  <svg class="gauge-svg" viewBox="0 0 36 36" aria-hidden="true">
                    <path
                      class="gauge-bg"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <path
                      class="gauge-fg current"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <text class="gauge-value" x="18" y="20">--</text>
                  </svg>
                </div>
                <div class="gauge-label">Courant (A)</div>
              </div>

              <div
                class="gauge-card"
                data-field="power_w"
                data-unit="W"
                data-max="500"
              >
                <div class="gauge">
                  <svg class="gauge-svg" viewBox="0 0 36 36" aria-hidden="true">
                    <path
                      class="gauge-bg"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <path
                      class="gauge-fg voltage"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <text class="gauge-value" x="18" y="20">--</text>
                  </svg>
                </div>
                <div class="gauge-label">Puissance (W)</div>
              </div>

              <div
                class="gauge-card"
                data-field="motor_c"
                data-unit="C"
                data-max="120"
              >
                <div class="gauge">
                  <svg class="gauge-svg" viewBox="0 0 36 36" aria-hidden="true">
                    <path
                      class="gauge-bg"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <path
                      class="gauge-fg temperature"
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                    ></path>
                    <text class="gauge-value" x="18" y="20">--</text>
                  </svg>
                </div>
                <div class="gauge-label">Temp moteur (C)</div>
              </div>
            </div>

            <div class="metric-row">
              <div class="metric-box">
                <div class="metric-label">Energie</div>
                <div class="metric-value" id="energyValue">-- Wh</div>
              </div>
              <div class="metric-box">
                <div class="metric-label">Temp carte</div>
                <div class="metric-value" id="boardValue">-- C</div>
              </div>
              <div class="metric-box">
                <div class="metric-label">Temp ambiante</div>
                <div class="metric-value" id="ambientValue">-- C</div>
              </div>
            </div>

            <div class="sensor-status">
              <div class="sensor-item">
                <span class="led" id="ds18Led"></span>DS18
              </div>
              <div class="sensor-item">
                <span class="led" id="bmeLed"></span>BME280
              </div>
              <div class="sensor-item">
                <span class="led" id="adcLed"></span>ADC
              </div>
              <div class="sensor-item"><span id="ageMs">age: -- ms</span></div>
            </div>

            <div class="controls">
              <button id="btnRelayOn">Relais marche</button>
              <button id="btnRelayOff">Relais arret</button>
              <button id="btnClearFault">Acquitter defaut</button>
            </div>

            <div class="timer-row">
              <label>
                Duree (s)
                <input id="runSeconds" type="number" min="1" value="10" />
              </label>
              <button id="btnRunTimer" class="btn">Marche temporisee</button>
              <span class="tiny" id="controlStatus">--</span>
            </div>
          </section>

          <section id="chartsTab" class="content">
            <div class="content-header">
              <div>
                <div class="page-title">Graphiques</div>
                <div class="tiny">Courant et temperature moteur</div>
              </div>
            </div>
            <div class="chart-grid">
              <div class="chart-card" data-series="current">
                <div class="chart-top">
                  <div>
                    <div class="chart-title">Courant / temps</div>
                    <div class="chart-sub">
                      Graduations Y fixes, glisser pour naviguer
                    </div>
                  </div>
                  <div class="chart-controls">
                    <button class="chart-btn" id="currentLatest" type="button">
                      Plus recent
                    </button>
                    <button class="chart-btn" id="currentPause" type="button">
                      Pause
                    </button>
                  </div>
                  <div class="chart-stats">
                    <div class="chart-pill">
                      Courant: <b id="currentNow">-- A</b>
                    </div>
                    <div class="chart-pill">
                      Temps: <b id="currentTime" class="mono">--:--:--</b>
                    </div>
                    <div class="chart-pill">Max: <b>20 A</b></div>
                  </div>
                </div>

                <div class="chart-shell">
                  <div class="axis-col">
                    <svg
                      id="currentAxis"
                      role="img"
                      aria-label="Axe Y courant"
                    ></svg>
                  </div>
                  <div
                    id="currentScroll"
                    class="chart-scroll"
                    title="Glisser pour naviguer"
                  >
                    <svg id="currentPlot" role="img" aria-label="Courant"></svg>
                  </div>
                </div>

                <div class="chart-footer">
                  Glisser la zone pour revenir dans le temps.
                </div>
              </div>
              <div class="chart-card" data-series="temp">
                <div class="chart-top">
                  <div>
                    <div class="chart-title">Temp moteur / temps</div>
                    <div class="chart-sub">
                      Graduations Y fixes, glisser pour naviguer
                    </div>
                  </div>
                  <div class="chart-controls">
                    <button class="chart-btn" id="tempLatest" type="button">
                      Plus recent
                    </button>
                    <button class="chart-btn" id="tempPause" type="button">
                      Pause
                    </button>
                  </div>
                  <div class="chart-stats">
                    <div class="chart-pill">Temp: <b id="tempNow">-- C</b></div>
                    <div class="chart-pill">
                      Temps: <b id="tempTime" class="mono">--:--:--</b>
                    </div>
                    <div class="chart-pill">Max: <b>150 C</b></div>
                  </div>
                </div>

                <div class="chart-shell">
                  <div class="axis-col">
                    <svg
                      id="tempAxis"
                      role="img"
                      aria-label="Axe Y temperature"
                    ></svg>
                  </div>
                  <div
                    id="tempScroll"
                    class="chart-scroll"
                    title="Glisser pour naviguer"
                  >
                    <svg
                      id="tempPlot"
                      role="img"
                      aria-label="Temperature"
                    ></svg>
                  </div>
                </div>

                <div class="chart-footer">
                  Glisser la zone pour revenir dans le temps.
                </div>
              </div>
            </div>
          </section>

          <section id="eventsTab" class="content">
            <div class="content-header">
              <div>
                <div class="page-title">Avertissements / Erreurs</div>
                <div class="tiny" id="eventMeta">seq: 0</div>
              </div>
            </div>
            <div id="eventList" class="event-list"></div>
          </section>

          <section id="configTab" class="content">
            <div class="content-header">
              <div>
                <div class="page-title">Configuration</div>
                <div class="tiny">
                  Parametres NVS (auth requise pour enregistrer)
                </div>
              </div>
            </div>

            <form id="configForm" class="settings-form">
              <div class="settings-grid">
                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/Warning.png"
                      alt=""
                    />
                    OVC / Courant
                  </div>
                  <div class="settings-field">
                    <label>limit_current_a</label>
                    <input name="limit_current_a" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>ovc_mode</label>
                    <select name="ovc_mode">
                      <option value="latch">latch</option>
                      <option value="auto">auto</option>
                    </select>
                  </div>
                  <div class="settings-field">
                    <label>ovc_min_ms</label>
                    <input name="ovc_min_ms" type="number" />
                  </div>
                  <div class="settings-field">
                    <label>ovc_retry_ms</label>
                    <input name="ovc_retry_ms" type="number" />
                  </div>
                </div>

                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/thermoHeatsink.png"
                      alt=""
                    />
                    Temperatures
                  </div>
                  <div class="settings-field">
                    <label>temp_motor_c</label>
                    <input name="temp_motor_c" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>temp_board_c</label>
                    <input name="temp_board_c" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>temp_ambient_c</label>
                    <input name="temp_ambient_c" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>temp_hyst_c</label>
                    <input name="temp_hyst_c" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>latch_overtemp</label>
                    <select name="latch_overtemp">
                      <option value="true">true</option>
                      <option value="false">false</option>
                    </select>
                  </div>
                </div>

                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/power.png"
                      alt=""
                    />
                    Puissance
                  </div>
                  <div class="settings-field">
                    <label>motor_vcc_v</label>
                    <input name="motor_vcc_v" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>sampling_hz</label>
                    <input name="sampling_hz" type="number" />
                  </div>
                  <div class="settings-field">
                    <label>buzzer_enabled</label>
                    <select name="buzzer_enabled">
                      <option value="true">true</option>
                      <option value="false">false</option>
                    </select>
                  </div>
                </div>

                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/wifi-3-bars.png"
                      alt=""
                    />
                    WiFi
                  </div>
                  <div class="settings-field">
                    <label>wifi_mode</label>
                    <select name="wifi_mode">
                      <option value="sta">sta</option>
                      <option value="ap">ap</option>
                    </select>
                  </div>
                  <div class="settings-field">
                    <label>sta_ssid</label>
                    <input name="sta_ssid" type="text" />
                  </div>
                  <div class="settings-field">
                    <label>sta_pass</label>
                    <input name="sta_pass" type="password" />
                  </div>
                  <div class="settings-field">
                    <label>ap_ssid</label>
                    <input name="ap_ssid" type="text" />
                  </div>
                  <div class="settings-field">
                    <label>ap_pass</label>
                    <input name="ap_pass" type="password" />
                  </div>
                </div>
              </div>

              <div class="settings-actions">
                <button class="btn" type="submit">Appliquer</button>
                <button class="btn" type="button" id="reloadConfig">
                  Recharger
                </button>
              </div>
              <div class="tiny" id="configStatus">--</div>
            </form>
          </section>

          <section id="serviceTab" class="content">
            <div class="content-header">
              <div>
                <div class="page-title">Service</div>
                <div class="tiny">Calibration, RTC, sessions</div>
              </div>
            </div>

            <div class="service-grid">
              <div class="service-col">
                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/redo-5-16.png"
                      alt=""
                    />
                    Calibration courant
                  </div>
                  <div class="settings-field">
                    <label>zero_mv</label>
                    <input id="calZeroMv" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>sens_mv_a</label>
                    <input id="calSens" type="number" step="0.1" />
                  </div>
                  <div class="settings-field">
                    <label>input_scale</label>
                    <input id="calScale" type="number" step="0.01" />
                  </div>
                  <div class="settings-actions">
                    <button class="btn" id="calZeroBtn" type="button">
                      Calib zero
                    </button>
                    <button class="btn" id="calApplyBtn" type="button">
                      Appliquer
                    </button>
                  </div>
                  <div class="tiny" id="calStatus">--</div>
                </div>

                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/refresh.png"
                      alt=""
                    />
                    RTC
                  </div>
                  <div class="tiny">
                    Synchronise l'heure interne avec l'heure du navigateur
                    (utile en mode AP).
                  </div>
                  <div class="settings-actions">
                    <button class="btn" id="rtcSyncBtn" type="button">
                      Synchroniser
                    </button>
                  </div>
                  <div class="tiny" id="rtcStatus">--</div>
                </div>
              </div>

              <div class="service-col service-col-wide">
                <div class="settings-card">
                  <div class="settings-card-title">
                    <img
                      class="settings-card-icon"
                      src="icons/ok_tank.png"
                      alt=""
                    />
                    Sessions (SPIFFS)
                  </div>
                  <div class="session-table-wrap">
                    <table class="session-table">
                      <thead>
                        <tr>
                          <th>debut</th>
                          <th>fin</th>
                          <th>duree</th>
                          <th>energie</th>
                          <th>pic W</th>
                          <th>pic A</th>
                          <th>ok</th>
                        </tr>
                      </thead>
                      <tbody id="sessionTableBody"></tbody>
                    </table>
                  </div>
                  <div class="settings-actions">
                    <button class="btn" id="sessionReloadBtn" type="button">
                      Recharger
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <script src="js/app.js"></script>
    <script src="js/mock.js"></script>
  </body>
</html>
